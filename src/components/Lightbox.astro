---
export interface Props {
    images: Array<{
        src: string;
        alt: string;
        title?: string;
        category?: string;
    }>;
}

const { images } = Astro.props;
---

<div
    class="lightbox-container"
    id="lightbox"
    role="dialog"
    aria-modal="true"
    aria-label="Image lightbox"
>
    <div class="lightbox-backdrop"></div>

    <div class="lightbox-content">
        <button
            class="lightbox-close"
            aria-label="Close lightbox"
            id="lightbox-close"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <path d="M18 6 6 18"></path>
                <path d="m6 6 12 12"></path>
            </svg>
        </button>

        <button
            class="lightbox-nav lightbox-prev"
            aria-label="Previous image"
            id="lightbox-prev"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <path d="m15 18-6-6 6-6"></path>
            </svg>
        </button>

        <button
            class="lightbox-nav lightbox-next"
            aria-label="Next image"
            id="lightbox-next"
        >
            <svg
                xmlns="http://www.w3.org/2000/svg"
                width="24"
                height="24"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="1.5"
                stroke-linecap="round"
                stroke-linejoin="round"
            >
                <path d="m9 18 6-6-6-6"></path>
            </svg>
        </button>

        <div class="lightbox-image-container">
            <img
                src="/placeholder.svg"
                alt=""
                class="lightbox-image"
                id="lightbox-image"
            />
        </div>

        <div class="lightbox-info" id="lightbox-info">
            <p class="lightbox-title" id="lightbox-title"></p>
            <p class="lightbox-counter" id="lightbox-counter"></p>
        </div>
    </div>
</div>

<style>
    .lightbox-container {
        position: fixed;
        inset: 0;
        z-index: 1000;
        display: none;
        align-items: center;
        justify-content: center;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .lightbox-container.open {
        display: flex;
        opacity: 1;
    }

    .lightbox-backdrop {
        position: absolute;
        inset: 0;
        background-color: rgba(0, 0, 0, 0.95);
    }

    .lightbox-content {
        position: relative;
        width: 100%;
        height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: 4rem 1rem;
    }

    @media (min-width: 768px) {
        .lightbox-content {
            padding: 4rem;
        }
    }

    .lightbox-close {
        position: absolute;
        top: 1rem;
        right: 1rem;
        width: 3rem;
        height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        border-radius: 0.5rem;
        transition: background-color 0.2s ease;
        z-index: 10;
    }

    .lightbox-close:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .lightbox-nav {
        position: absolute;
        top: 50%;
        transform: translateY(-50%);
        width: 3rem;
        height: 3rem;
        display: flex;
        align-items: center;
        justify-content: center;
        background: none;
        border: none;
        color: white;
        cursor: pointer;
        border-radius: 0.5rem;
        transition: background-color 0.2s ease;
        z-index: 10;
    }

    .lightbox-nav:hover {
        background-color: rgba(255, 255, 255, 0.1);
    }

    .lightbox-prev {
        left: 0.5rem;
    }

    @media (min-width: 768px) {
        .lightbox-prev {
            left: 1rem;
        }
    }

    .lightbox-next {
        right: 0.5rem;
    }

    @media (min-width: 768px) {
        .lightbox-next {
            right: 1rem;
        }
    }

    .lightbox-image-container {
        position: relative;
        max-width: 100%;
        max-height: 100%;
        display: flex;
        align-items: center;
        justify-content: center;
    }

    .lightbox-image {
        max-width: 100%;
        max-height: calc(100vh - 10rem);
        object-fit: contain;
        border-radius: 0.25rem;
        opacity: 0;
        transition: opacity 0.3s ease;
    }

    .lightbox-image.loaded {
        opacity: 1;
    }

    .lightbox-info {
        position: absolute;
        bottom: 1rem;
        left: 50%;
        transform: translateX(-50%);
        text-align: center;
        color: white;
    }

    .lightbox-title {
        font-size: 0.875rem;
        margin-bottom: 0.25rem;
    }

    .lightbox-counter {
        font-size: 0.75rem;
        color: rgba(255, 255, 255, 0.6);
    }
</style>

<script define:vars={{ images }}>
    const lightbox = document.getElementById("lightbox");
    const lightboxImage = document.getElementById("lightbox-image");
    const lightboxTitle = document.getElementById("lightbox-title");
    const lightboxCounter = document.getElementById("lightbox-counter");
    const closeBtn = document.getElementById("lightbox-close");
    const prevBtn = document.getElementById("lightbox-prev");
    const nextBtn = document.getElementById("lightbox-next");
    const backdrop = lightbox?.querySelector(".lightbox-backdrop");

    let currentIndex = 0;
    const galleryImages = images;

    function openLightbox(index) {
        currentIndex = index;
        updateLightboxImage();
        lightbox?.classList.add("open");
        document.body.style.overflow = "hidden";
    }

    function closeLightbox() {
        lightbox?.classList.remove("open");
        document.body.style.overflow = "";
    }

    function updateLightboxImage() {
        const image = galleryImages[currentIndex];
        if (lightboxImage && image) {
            lightboxImage.classList.remove("loaded");
            lightboxImage.src = image.src;
            lightboxImage.alt = image.alt;
            lightboxImage.onload = () => {
                lightboxImage.classList.add("loaded");
            };
        }
        if (lightboxTitle) {
            lightboxTitle.textContent =
                galleryImages[currentIndex]?.title || "";
        }
        if (lightboxCounter) {
            lightboxCounter.textContent = `${currentIndex + 1} / ${galleryImages.length}`;
        }
    }

    function showPrev() {
        currentIndex =
            (currentIndex - 1 + galleryImages.length) % galleryImages.length;
        updateLightboxImage();
    }

    function showNext() {
        currentIndex = (currentIndex + 1) % galleryImages.length;
        updateLightboxImage();
    }

    // Event listeners
    closeBtn?.addEventListener("click", closeLightbox);
    backdrop?.addEventListener("click", closeLightbox);
    prevBtn?.addEventListener("click", showPrev);
    nextBtn?.addEventListener("click", showNext);

    // Keyboard navigation
    document.addEventListener("keydown", (e) => {
        if (!lightbox?.classList.contains("open")) return;

        switch (e.key) {
            case "Escape":
                closeLightbox();
                break;
            case "ArrowLeft":
                showPrev();
                break;
            case "ArrowRight":
                showNext();
                break;
        }
    });

    // Make openLightbox available globally
    window.openLightbox = openLightbox;
</script>
